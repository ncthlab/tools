<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>築盆作業紀錄表</title>
	<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 350px; /* 修改寬度 */
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        .inline-group {
            display: flex;
            justify-content: space-between;
        }
        label {
            font-weight: bold;
        }
        
	/* 隱藏元素的CSS */
        .hidden {
            display: none;
        }
	
	

	

    </style>
    <script>
		function exportData() {
    const typeText = document.querySelector("select[name='type'] option:checked").textContent;
	
    const formData = {
        customer: document.querySelector("input[name='customer']").value,
        filled_by: document.querySelector("input[name='filled_by']").value,
        date: document.querySelector("input[name='date']").value,
        type: document.querySelector("select[name='type']").value,
        tank_quantity: document.querySelector("select[name='tank_quantity']").value,
        inner_tank_quantity: document.querySelector("select[name='inner_tank_quantity']").value,
        ownership: document.querySelector("input[name='ownership']:checked")?.value,
        sintering: document.querySelector("input[name='sintering']:checked")?.value,
        accessories: Array.from(document.querySelectorAll("input[name='accessory']:checked")).map(checkbox => checkbox.value),
        other_accessory: document.querySelector("input[name='other_accessory']").value.trim(), // 其他配件
	insulation: document.querySelector("input[name='insulation']:checked")?.value,
        side_insulation: document.querySelector("input[name='side_insulation']").value,
        side_total: document.querySelector("input[name='side_total']").value,
        bottom_insulation: document.querySelector("input[name='bottom_insulation']").value,
        bottom_total: document.querySelector("input[name='bottom_total']").value,
	
	
	
        workers: [
            document.querySelector("input[name='worker1']").value,
            document.querySelector("input[name='worker2']").value,
            document.querySelector("input[name='worker3']").value
        ],
        // 新增日期欄位
        customer_due: document.querySelector("input[name='customer_due']").value,
        actual_delivery: document.querySelector("input[name='actual_delivery']").value,
        start_date: document.querySelector("input[name='start_date']").value,
        completion_date: document.querySelector("input[name='completion_date']").value,
        
	// 使用材料
        material: document.querySelector("#material").value,
        estimatedAmount: document.querySelector("#estimatedAmount").value,
        actualAmount: document.querySelector("#actualAmount").value,
        emptyBowlWeight: document.querySelector("#emptyBowlWeight").value,
        finalWeight: document.querySelector("#finalWeight").value,
	
	// **保存澆盆與內桶編號**
        tank_numbers: Array.from(document.querySelectorAll("input[name^='number_']")).map(input => input.value.trim()),
        inner_tank_numbers: Array.from(document.querySelectorAll("input[name^='inner_tank_number_']")).map(input => input.value.trim()),

    };

    const fileName = `${formData.date.replace(/-/g, '')}_${formData.customer}_${typeText}.json`;

    const blob = new Blob([JSON.stringify(formData, null, 2)], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = fileName;
    link.click();
}





		function importData(event) {
    		const file = event.target.files[0];
    if (file && file.name.endsWith('.json')) {
        const reader = new FileReader();
        reader.onload = function (e) {
            const formData = JSON.parse(e.target.result);
            
            // 填充文字輸入框
            document.querySelector("input[name='customer']").value = formData.customer;
            document.querySelector("input[name='filled_by']").value = formData.filled_by;
            document.querySelector("input[name='date']").value = formData.date;
            document.querySelector("select[name='type']").value = formData.type;
            document.querySelector("select[name='tank_quantity']").value = formData.tank_quantity;
            document.querySelector("select[name='inner_tank_quantity']").value = formData.inner_tank_quantity;
		document.querySelector("input[name='other_accessory']").value = formData.other_accessory || "";

            
            // 填充工人欄位
            formData.workers.forEach((worker, index) => {
                document.querySelector(`input[name='worker${index + 1}']`).value = worker;
            });

            // 填充單選框 (Radio Buttons)
            if (formData.ownership) {
                document.querySelector(`input[name='ownership'][value='${formData.ownership}']`).checked = true;
            }
            if (formData.sintering) {
                document.querySelector(`input[name='sintering'][value='${formData.sintering}']`).checked = true;
            }
            if (formData.insulation) {
                document.querySelector(`input[name='insulation'][value='${formData.insulation}']`).checked = true;
            }

	

            // 填充多選框 (Checkboxes)
            if (formData.accessories && formData.accessories.length > 0) {
                formData.accessories.forEach(accessory => {
                    const checkbox = document.querySelector(`input[name='accessory'][value='${accessory}']`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
            }
		
		
	

            // 填充保溫層欄位
            document.querySelector("input[name='side_insulation']").value = formData.side_insulation;
            document.querySelector("input[name='side_total']").value = formData.side_total;
            document.querySelector("input[name='bottom_insulation']").value = formData.bottom_insulation;
            document.querySelector("input[name='bottom_total']").value = formData.bottom_total;
		
	if (formData.side_insulation) {
                document.querySelector("input[name='side_insulation']").value = formData.side_insulation;
            }
            if (formData.side_total) {
                document.querySelector("input[name='side_total']").value = formData.side_total;
            }
            if (formData.bottom_insulation) {
                document.querySelector("input[name='bottom_insulation']").value = formData.bottom_insulation;
            }
            if (formData.bottom_total) {
                document.querySelector("input[name='bottom_total']").value = formData.bottom_total;
            }

            // 若保溫層選擇「有」，則顯示側邊與底部欄位
            updateInsulationFields();
		
            
            // 新增填充日期欄位
            document.querySelector("input[name='customer_due']").value = formData.customer_due;
            document.querySelector("input[name='actual_delivery']").value = formData.actual_delivery;
            document.querySelector("input[name='start_date']").value = formData.start_date;
            document.querySelector("input[name='completion_date']").value = formData.completion_date;
		
		 // **新增填充「使用材料、預估用量、實際用量、空盆重量、成品重量」**
            document.querySelector("input[name='material']").value = formData.material;
            document.querySelector("input[name='estimatedAmount']").value = formData.estimatedAmount;
            document.querySelector("input[name='actualAmount']").value = formData.actualAmount;
            document.querySelector("input[name='emptyBowlWeight']").value = formData.emptyBowlWeight;
            document.querySelector("input[name='finalWeight']").value = formData.finalWeight;
		
		 // 先生成澆盆與內桶的欄位
            updateTankFields();
            updateTankOwnershipFields();

            // 填充澆盆編號
            if (formData.tank_numbers && Array.isArray(formData.tank_numbers)) {
                formData.tank_numbers.forEach((number, index) => {
                    let input = document.querySelector(`input[name='number_${index + 1}']`);
                    if (input) {
                        input.value = number;
                    }
                });
            }

            // 填充內桶編號
            if (formData.inner_tank_numbers && Array.isArray(formData.inner_tank_numbers)) {
                formData.inner_tank_numbers.forEach((number, index) => {
                    let input = document.querySelector(`input[name='inner_tank_number_${index + 1}']`);
                    if (input) {
                        input.value = number;
                    }
                });
            }
        };
        reader.readAsText(file);
    }
}




		function updateInsulationFields() {
            const insulation = document.querySelector("input[name='insulation']:checked")?.value;
            const sideInput = document.querySelector("input[name='side_insulation']");
            const sideTotalInput = document.querySelector("input[name='side_total']");
            const bottomInput = document.querySelector("input[name='bottom_insulation']");
            const bottomTotalInput = document.querySelector("input[name='bottom_total']");
            const sideContainer = document.getElementById("side_fields");
            const bottomContainer = document.getElementById("bottom_fields");

            if (insulation === "none") {
                // 隱藏側邊與底部欄位
                sideContainer.classList.add("hidden");
                bottomContainer.classList.add("hidden");
		// 清空欄位數值（避免錯誤提交）
        sideInput.value = "";
        sideTotalInput.value = "";
        bottomInput.value = "";
        bottomTotalInput.value = "";
            } else {
                // 顯示側邊與底部欄位，並設置預設值
                sideContainer.classList.remove("hidden");
                bottomContainer.classList.remove("hidden");
                sideInput.value = "軟(6mm)+硬(3mm)";
                sideTotalInput.value = "9 mm";
                bottomInput.value = "軟(6mm)x2+硬(3mm)x2";
                bottomTotalInput.value = "18 mm";
            }
        }

        
		
        function updateTankFields() {
            const quantity = document.querySelector("select[name='tank_quantity']").value;
            const container = document.getElementById("tank_number_fields");
            container.innerHTML = ""; // 清空原有欄位

            if (quantity > 0) {
                for (let i = 1; i <= quantity; i++) {
                    const inputGroup = document.createElement("div");
                    inputGroup.classList.add("form-group");

                    const label = document.createElement("label");
                    label.textContent = `澆盆編號 ${i}：`;
                    const input = document.createElement("input");
                    input.type = "text";
                    input.name = `number_${i}`;
                    input.required = true;

                    inputGroup.appendChild(label);
                    inputGroup.appendChild(input);
                    container.appendChild(inputGroup);
                }
            }
        }

        function updateTankOwnershipFields() {
            const quantity = document.querySelector("select[name='inner_tank_quantity']").value;
            const container = document.getElementById("inner_tank_number_fields");
            container.innerHTML = ""; // 清空原有欄位

            if (quantity > 0) {
                for (let i = 1; i <= quantity; i++) {
                    const inputGroup = document.createElement("div");
                    inputGroup.classList.add("form-group");

                    const label = document.createElement("label");
                    label.textContent = `內桶編號 ${i}：`;
                    const input = document.createElement("input");
                    input.type = "text";
                    input.name = `inner_tank_number_${i}`;
                    input.required = true;

                    inputGroup.appendChild(label);
                    inputGroup.appendChild(input);
                    container.appendChild(inputGroup);
                }
            }
        }

        function takeScreenshot() {
    html2canvas(document.body, {
        border: 0 // 禁用邊框渲染
    }).then(canvas => {
        let date = document.querySelector("input[name='date']").value;
        let customer = document.querySelector("input[name='customer']").value || "未填寫";
        let type = document.querySelector("input[name='type']:checked")?.value || "未選擇";
        let fileName = `${date}_${customer}_${type}.png`;

        let link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = fileName;
        link.click();
    });
}


        window.onload = function() {
            document.querySelector("input[name='side_insulation']").value = "軟(6mm)+硬(3mm)";
            document.querySelector("input[name='side_total']").value = "9";
            document.querySelector("input[name='bottom_insulation']").value = "軟(6mm)x2+硬(3mm)x2";
            document.querySelector("input[name='bottom_total']").value = "18";
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
	
    <div class="container">
        <h2>築盆作業紀錄表</h2>
	
        <form>

            <div class="form-group inline-group">
    <label>客戶名稱：<input type="text" name="customer" required></label>
</div>
<!-- 將填表人移到下一行 -->
<div class="form-group">
    <label>填表人：<input type="text" name="filled_by" required></label>
</div>
            <!-- 將填表日期移到下一行 -->
            <div class="form-group">
                <label>填表日期：<input type="date" name="date" required></label>
            </div>
            <div class="form-group">
    <label for="type">澆盆種類：</label>
    <select name="type" id="type">
        <option value="" disabled selected>請選擇澆盆種類</option>
        <option value="APL">自動盆(APL)</option>
        <option value="TL">交換盆(TL)</option>
        <option value="RML">回爐盆(RML)</option>
        <option value="SL">球化盆(SL)</option>
    </select>
</div>

            <div class="form-group">
                <label for="tank_quantity">澆盆數量：</label>
                <select name="tank_quantity" id="tank_quantity" onchange="updateTankFields()">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <div id="tank_number_fields"></div>

            <div class="form-group">
                <label>內桶歸屬：</label>
                <input type="radio" name="ownership" value="customer"> 客戶
                <input type="radio" name="ownership" value="company"> 見得行
            </div>

            <div class="form-group">
                <label for="inner_tank_quantity">內桶數量：</label>
                <select name="inner_tank_quantity" id="inner_tank_quantity" onchange="updateTankOwnershipFields()">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>

            <div id="inner_tank_number_fields"></div>

            <div class="form-group">
                <label>燒結：</label>
                <input type="radio" name="sintering" value="no"> 否
		<input type="radio" name="sintering" value="yes"> 是
            </div>
            <div class="form-group">
                <label>澆盆尺寸示意圖：</label><br>
                <img src="https://raw.githubusercontent.com/ncthlab/tools/refs/heads/main/images/%E6%BE%86%E7%9B%86%E5%B0%BA%E5%AF%B8%E7%A4%BA%E6%84%8F%E5%9C%96.png" alt="澆盆尺寸示意圖" width="100%">
            </div>
            <div class="form-group">
    <label>其他配件：</label><br>
<span style="font-size: smaller; color: #808080;">括號內通常隨附 依實際客戶提供為主</span><br>
    <input type="checkbox" name="accessory" value="斜管"> 斜管 ( <input type="checkbox" name="accessory" value="鐵鉤"> 鐵鉤 )
	<br>
    <input type="checkbox" name="accessory" value="ㄇ形吊桿"> ㄇ形吊桿 ( <input type="checkbox" name="accessory" value="插銷"> 插銷 x 2 )
	<br>
    <input type="checkbox" name="accessory" value="盆嘴製具"> 盆嘴製具 ( <input type="checkbox" name="accessory" value="擋渣板製具"> 擋渣板製具 )
	<br>
    <input type="checkbox" name="accessory" value="盆蓋"> 盆蓋
    <br>
    <input type="checkbox" name="accessory" value="其他"> 其他
    <input type="text" name="other_accessory" placeholder="請輸入其他配件" style="width: 50%;">
	</div>
            <!-- 保溫層選項 -->
            <div class="form-group">
                <label>保溫層：</label>
                <input type="radio" name="insulation" value="none" onclick="updateInsulationFields()"> 無
                <input type="radio" name="insulation" value="yes" onclick="updateInsulationFields()"> 有
            </div>

            <!-- 側邊與底部輸入欄位，預設為隱藏 -->
            <div id="side_fields" class="hidden">
                <div class="form-group">
                    側邊：<input type="text" name="side_insulation" value="軟(6mm)+硬(3mm)"> ，共 <input type="text" name="side_total" size="5"> mm
                </div>
            </div>

            <div id="bottom_fields" class="hidden">
                <div class="form-group">
                    底部：<input type="text" name="bottom_insulation" value="軟(6mm)x2+硬(3mm)x2"> ，共 <input type="text" name="bottom_total" size="5"> mm
                </div>
            </div>
	<div class="form-group">
        <label for="material">使用材料：</label>
        <input type="text" id="material" name="material" required><br>
        
        <label for="estimatedAmount">預估用量（KG）：</label>
        <input type="number" id="estimatedAmount" name="estimatedAmount" step="0.01" required><br>

        <label for="actualAmount">實際用量（KG）：</label>
        <input type="number" id="actualAmount" name="actualAmount" step="0.01" required><br>

        <label for="emptyBowlWeight">空盆重量（KG）：</label>
        <input type="number" id="emptyBowlWeight" name="emptyBowlWeight" step="0.01" required><br>

        <label for="finalWeight">成品重量（KG）：</label>
        <input type="number" id="finalWeight" name="finalWeight" step="0.01" required><br>

   	</div>
            <div class="form-group">
    <div>

        <label>客戶預交期：<input type="date" name="customer_due"></label>
    </div>
    <div>
        <label>實際出貨日：<input type="date" name="actual_delivery"></label>
    </div>
</div>
<div class="form-group">
    <div>
        <label>起始日期：<input type="date" name="start_date"></label>
    </div>
    <div>
        <label>完工日期：<input type="date" name="completion_date"></label>
    </div>
</div>

           <div class="form-group">
    <label>作業人員：</label>
    <div>
        <input type="text" name="worker1" size="10">
    </div>
    <div>
        <input type="text" name="worker2" size="10">
    </div>
    <div>
        <input type="text" name="worker3" size="10">
    </div>
</div>
            <button type="button" onclick="takeScreenshot()">截圖</button>
		<button type="button" onclick="exportData()">匯出資料</button>
		<input type="file" accept=".json" onchange="importData(event)">

        </form>
	
    </div>
	
</body>
</html>
